{% load static %}
{% include 'stock/headers.html' %}

<div class="nk-content ">
    <div class="container-fluid">
        <div class="nk-content-inner">
            <div class="nk-content-body">
               <div class="nk-block-head nk-block-head-sm">
                    <div class="nk-block-between">
                        <div class="nk-block-head-content">
                            <h3 class="nk-block-title page-title">Dashboard</h3>
                        </div><!-- .nk-block-head-content -->
                        <div class="nk-block-head-content">
                            <div class="toggle-wrap nk-block-tools-toggle">
                                <a href="#" class="btn btn-icon btn-trigger toggle-expand mr-n1" data-target="pageMenu"><em class="icon ni ni-more-v"></em></a>
                                <div class="toggle-expand-content" data-content="pageMenu">
                                    <ul class="nk-block-tools g-3">
                                        <li class="nk-block-tools-opt"><a href="/view_history" class="btn btn-primary"><em class="icon ni ni-reports"></em><span>Reports</span></a></li>
                                    </ul>
                                </div>
                            </div>
                        </div><!-- .nk-block-head-content -->
                    </div><!-- .nk-block-between -->
                </div><!-- .nk-block-head -->
                <div class="nk-block">
                    <div class="row g-gs">
                         <div class="col-xxl-3 col-sm-6">
                            <div class="card">
                                <div class="nk-ecwg nk-ecwg6">
                                    <div class="card-inner">
                                        <div class="card-title-group">
                                            <div class="card-title">
                                                <h6 class="title">Total Stocks</h6>
                                            </div>
                                        </div>
                                        <div class="data">
                                            <div class="data-group">
                                                <div class="amount">{{body}}</div>
                                                <div class="nk-ecwg6-ck">
                                                    <canvas class="ecommerce-line-chart-s3" id="todayOrders"></canvas>
                                                </div>
                                            </div>
                                        </div>
                                    </div><!-- .card-inner -->
                                </div><!-- .nk-ecwg -->
                            </div><!-- .card -->
                        </div><!-- .col -->
        <div class="col-xxl-3 col-sm-6">
                            <div class="card">
                                <div class="nk-ecwg nk-ecwg6">
                                    <div class="card-inner">
                                        <div class="card-title-group">
                                            <div class="card-title">
                                                <h6 class="title">Total History</h6>
                                            </div>
                                        </div>
                                        <div class="data">
                                            <div class="data-group">
                                                <div class="amount">{{mind}}</div>
                                                <div class="nk-ecwg6-ck">
                                                    <canvas class="ecommerce-line-chart-s3" id="todayRevenue"></canvas>
                                                </div>
                                            </div>
                                        </div>
                                    </div><!-- .card-inner -->
                                </div><!-- .nk-ecwg -->
                            </div><!-- .card -->
                        </div><!-- .col -->
        <div class="col-xxl-3 col-sm-6">
                            <div class="card">
                                <div class="nk-ecwg nk-ecwg6">
                                    <div class="card-inner">
                                        <div class="card-title-group">
                                            <div class="card-title">
                                                <h6 class="title">Total Categories</h6>
                                            </div>
                                        </div>
                                        <div class="data">
                                            <div class="data-group">
                                                <div class="amount">{{soul}}</div>
                                                <div class="nk-ecwg6-ck">
                                                    <canvas class="ecommerce-line-chart-s3" id="todayCustomers"></canvas>
                                                </div>
                                            </div>
                                        </div>
                                    </div><!-- .card-inner -->
                                </div><!-- .nk-ecwg -->
                            </div><!-- .card -->
                        </div><!-- .col -->
         <div class="col-xxl-3 col-sm-6">
                            <div class="card">
                                <div class="nk-ecwg nk-ecwg6">
                                    <div class="card-inner">
                                        <div class="card-title-group">
                                            <div class="card-title">
                                                <h6 class="title">Today's Visitors</h6>
                                            </div>
                                        </div>
                                        <div class="data">
                                            <div class="data-group">
                                                <div class="amount">{{count}}</div>
                                                <div class="nk-ecwg6-ck">
                                                    <canvas class="ecommerce-line-chart-s3" id="todayVisitors"></canvas>
                                                </div>
                                            </div>
                                        </div>
                                    </div><!-- .card-inner -->
                                </div><!-- .nk-ecwg -->
                            </div><!-- .card -->
                        </div><!-- .col -->
                    </div><!-- .row -->
                </div><!-- .nk-block -->
                
                <!-- Transfer Alerts Section -->
                {% if pending_transfers or in_transit_transfers or awaiting_collection_transfers or active_commitments %}
                <div class="nk-block">
                    <div class="nk-block-head nk-block-head-sm">
                        <div class="nk-block-between">
                            <div class="nk-block-head-content">
                                <h5 class="nk-block-title">Stock Alerts</h5>
                                <p class="nk-block-des">Items with pending transfers, in transit, or committed to customers</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row g-gs">
                        <!-- Pending Transfers -->
                        {% if pending_transfers %}
                        <div class="col-lg-4">
                            <div class="card">
                                <div class="card-inner">
                                    <div class="card-title-group">
                                        <div class="card-title">
                                            <h6 class="title text-warning">
                                                <em class="icon ni ni-clock"></em>
                                                Pending Approval ({{ pending_transfers.count }})
                                            </h6>
                                        </div>
                                    </div>
                                    <div class="card-text">
                                        {% for transfer in pending_transfers %}
                                        <div class="alert alert-warning alert-pro alert-dismissible" role="alert">
                                            <div class="alert-text">
                                                <strong>{{ transfer.stock.item_name }}</strong><br>
                                                <small>{{ transfer.quantity }} units from {{ transfer.from_location.name }} → {{ transfer.to_location.name }}</small><br>
                                                <small class="text-muted">{{ transfer.get_transfer_type_display }} • Created {{ transfer.created_at|timesince }} ago</small>
                                            </div>
                                            <div class="alert-action">
                                                <a href="{% url 'transfer_list' %}" class="btn btn-xs btn-outline-warning">View</a>
                                            </div>
                                        </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                        
                        <!-- In Transit -->
                        {% if in_transit_transfers %}
                        <div class="col-lg-4">
                            <div class="card">
                                <div class="card-inner">
                                    <div class="card-title-group">
                                        <div class="card-title">
                                            <h6 class="title text-info">
                                                <em class="icon ni ni-truck"></em>
                                                In Transit ({{ in_transit_transfers.count }})
                                            </h6>
                                        </div>
                                    </div>
                                    <div class="card-text">
                                        {% for transfer in in_transit_transfers %}
                                        <div class="alert alert-info alert-pro alert-dismissible" role="alert">
                                            <div class="alert-text">
                                                <strong>{{ transfer.stock.item_name }}</strong><br>
                                                <small>{{ transfer.quantity }} units from {{ transfer.from_location.name }} → {{ transfer.to_location.name }}</small><br>
                                                <small class="text-muted">{{ transfer.get_transfer_type_display }} • In transit {{ transfer.approved_at|timesince }}</small>
                                            </div>
                                            <div class="alert-action">
                                                <a href="{% url 'transfer_list' %}" class="btn btn-xs btn-outline-info">View</a>
                                            </div>
                                        </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                        
                        <!-- Awaiting Collection -->
                        {% if awaiting_collection_transfers %}
                        <div class="col-lg-4">
                            <div class="card">
                                <div class="card-inner">
                                    <div class="card-title-group">
                                        <div class="card-title">
                                            <h6 class="title text-success">
                                                <em class="icon ni ni-user-check"></em>
                                                Awaiting Collection ({{ awaiting_collection_transfers.count }})
                                            </h6>
                                        </div>
                                    </div>
                                    <div class="card-text">
                                        {% for transfer in awaiting_collection_transfers %}
                                        <div class="alert alert-success alert-pro alert-dismissible" role="alert">
                                            <div class="alert-text">
                                                <strong>{{ transfer.stock.item_name }}</strong><br>
                                                <small>{{ transfer.quantity }} units for {{ transfer.customer_name|default:"Customer" }}</small><br>
                                                <small class="text-muted">At {{ transfer.to_location.name }} • Ready {{ transfer.completed_at|timesince }} ago</small>
                                            </div>
                                            <div class="alert-action">
                                                <a href="{% url 'transfer_list' %}" class="btn btn-xs btn-outline-success">View</a>
                                            </div>
                                        </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                        <!-- Committed Stock -->
                        {% if active_commitments %}
                        <div class="col-lg-4">
                            <div class="card">
                                <div class="card-inner">
                                    <div class="card-title-group">
                                        <div class="card-title">
                                            <h6 class="title text-primary">
                                                <em class="icon ni ni-user-fill"></em>
                                                Customer Commitments ({{ active_commitments.count }})
                                            </h6>
                                        </div>
                                    </div>
                                    <div class="card-text" style="max-height: 400px; overflow-y: auto;">
                                        {% for commitment in active_commitments %}
                                        <div class="alert alert-primary alert-pro alert-dismissible" role="alert">
                                            <div class="alert-text">
                                                <strong>{{ commitment.stock.item_name }}</strong><br>
                                                <small><strong>Customer:</strong> {{ commitment.customer_name }}</small><br>
                                                <small><strong>Quantity:</strong> {{ commitment.quantity }} units</small><br>
                                                <small><strong>Order #:</strong> {{ commitment.customer_order_number }}</small><br>
                                                <small><strong>Deposit:</strong> ${{ commitment.deposit_amount }}</small><br>
                                                {% if commitment.customer_phone %}
                                                <small><strong>Phone:</strong> {{ commitment.customer_phone }}</small><br>
                                                {% endif %}
                                                <small class="text-muted">Committed {{ commitment.committed_at|timesince }} ago</small>
                                            </div>
                                            <div class="alert-action">
                                                <a href="{% url 'stock_detail' commitment.stock.pk %}" class="btn btn-xs btn-outline-primary">View Stock</a>
                                            </div>
                                        </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endif %}
                
                <!-- Charts Section -->
                <div class="nk-block">
                    <div class="row g-gs">
                         <div class="col-xxl-6">
                                            <div class="card card-full">
                                                <div class="nk-ecwg nk-ecwg8 h-100">
                                                    <div class="card-inner">
                                                        <div class="card-title-group mb-3">
                                                            <div class="card-title">
                                                                <h6 class="title">Stock Statistics based on Item name</h6>
                                                            </div>
                                                        </div>
                                                        <div class="nk-ecwg8-ck">
                                                          <canvas class="line-chart chartjs-render-monitor" id="solidLineChart" width="327" height="225" style="display: block; height: 180px; width: 262px;"></canvas>
                                                        </div>
                                                        <div class="chart-label-group pl-5">
                                                            <div class="chart-label"></div>
                                                            <div class="chart-label">{% now "jS F Y H:i" %}</div>
                                                        </div>
                                                    </div><!-- .card-inner -->
                                                </div>
                                            </div><!-- .card -->
                                        </div><!-- .col -->

                         <div class="col-xxl-6">
                                            <div class="card card-full">
                                                <div class="nk-ecwg nk-ecwg8 h-100">
                                                    <div class="card-inner">
                                                        <div class="card-title-group mb-3">
                                                            <div class="card-title">
                                                                <h6 class="title">Stock Statistics based on Item name</h6>
                                                            </div>
                                                        </div>
                                                        <div class="nk-ecwg8-ck">
                                                          <canvas class="line-chart chartjs-render-monitor" id="solidDataChart" width="327" height="225" style="display: block; height: 180px; width: 262px;"></canvas>
                                                        </div>
                                                        <div class="chart-label-group pl-5">
                                                            <div class="chart-label"></div>
                                                            <div class="chart-label">{% now "jS F Y H:i" %}</div>
                                                        </div>
                                                    </div><!-- .card-inner -->
                                                </div>
                                            </div><!-- .card -->
                                        </div><!-- .col -->
                         <div class="col-xxl-6">
                                            <div class="card card-full">
                                                <div class="nk-ecwg nk-ecwg8 h-100">
                                                    <div class="card-inner">
                                                        <div class="card-title-group mb-3">
                                                            <div class="card-title">
                                                                <h6 class="title">Stock Statistics based on Category</h6>
                                                            </div>
                                                        </div>
                                                        <div class="nk-ecwg8-ck">
                                                          <canvas class="pie-chart chartjs-render-monitor" id="pieItemData" width="327" height="225" style="display: block; height: 180px; width: 262px;"></canvas>
                                                        </div>
                                                        <div class="chart-label-group pl-5">
                                                            <div class="chart-label"></div>
                                                            <div class="chart-label">{% now "jS F Y H:i" %}</div>
                                                        </div>
                                                    </div><!-- .card-inner -->
                                                </div>
                                            </div><!-- .card -->
                                        </div><!-- .col -->


                        <div style="width: 100%;" class="nk-block nk-block-lg">
                                        <div class="nk-block-head">
                                            <div class="nk-block-head-content">
                                                <h4 class="nk-block-title">Stock History Analytics based on Category</h4>
                                            </div>
                                        </div>
                                        <div class="row g-gs">
                                            <div class="col-md-6">
                                                <div class="card card-preview">
                                                    <div class="card-inner">
                                                        <div class="card-head text-center">
                                                            <h6 class="title">Recently Issued</h6>
                                                        </div>
                                                        <div class="nk-ck-sm">
                                                            <canvas class="bar-chart chartjs-render-monitor" id="barChartData"></canvas>
                                                        </div>
                                                    </div>
                                                </div><!-- .card-preview -->
                                            </div>
                                            <div class="col-md-6">
                                                <div class="card card-preview">
                                                    <div class="card-inner">
                                                        <div class="card-head text-center">
                                                            <h6 class="title">Recently Received</h6>
                                                        </div>
                                                        <div class="nk-ck-sm">
                                                            <canvas class="doughnut-chart" id="doughnutChartData"></canvas>
                                                        </div>
                                                    </div>
                                                </div><!-- .card-preview -->
                                            </div>
                                        </div>
                                    </div>

                         <div style="width: 100%;" class="nk-block nk-block-lg">
                                        <div class="nk-block-head">
                                            <div class="nk-block-head-content">
                                                <h4 class="nk-block-title">Stock History Analytics based on Item name</h4>
                                            </div>
                                        </div>
                                        <div class="row g-gs">
                                            <div class="col-md-6">
                                                <div class="card card-preview">
                                                    <div class="card-inner">
                                                        <div class="card-head text-center">
                                                            <h6 class="title">Recently Issued</h6>
                                                        </div>
                                                        <div class="nk-ck-sm">
                                                            <canvas class="bar-chart chartjs-render-monitor" id="barItemData"></canvas>
                                                        </div>
                                                    </div>
                                                </div><!-- .card-preview -->
                                            </div>
                                            <div class="col-md-6">
                                                <div class="card card-preview">
                                                    <div class="card-inner">
                                                        <div class="card-head text-center">
                                                            <h6 class="title">Recently Received</h6>
                                                        </div>
                                                        <div class="nk-ck-sm">
                                                            <canvas class="doughnut-chart" id="doughnutItemData"></canvas>
                                                        </div>
                                                    </div>
                                                </div><!-- .card-preview -->
                                            </div>
                                        </div>
                                    </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% include 'stock/footers.html' %}



