{% load static %}
{% include 'stock/headers.html' %}

<div class="nk-content ">
    <div class="container-fluid">
        <div class="nk-content-inner">
            <div class="nk-content-body">
               <div class="nk-block-head nk-block-head-sm">
                    <div class="nk-block-between">
                        <div class="nk-block-head-content">
                            <h3 class="nk-block-title page-title">Admin Dashboard</h3>
                            <p class="nk-block-des text-soft">Complete system overview and management</p>
                        </div>
                        <div class="nk-block-head-content">
                            <div class="toggle-wrap nk-block-tools-toggle">
                                <a href="#" class="btn btn-icon btn-trigger toggle-expand mr-n1" data-target="pageMenu"><em class="icon ni ni-more-v"></em></a>
                                <div class="toggle-expand-content" data-content="pageMenu">
                                    <ul class="nk-block-tools g-3">
                                        <li class="nk-block-tools-opt"><a href="/view_history" class="btn btn-primary"><em class="icon ni ni-reports"></em><span>Reports</span></a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Key Metrics -->
                <div class="nk-block">
                    <div class="row g-gs">
                        <div class="col-xxl-3 col-sm-6">
                            <div class="card">
                                <div class="nk-ecwg nk-ecwg6">
                                    <div class="card-inner">
                                        <div class="card-title-group">
                                            <div class="card-title">
                                                <h6 class="title">Total Stock Items</h6>
                                            </div>
                                        </div>
                                        <div class="data">
                                            <div class="amount">{{body}}</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-xxl-3 col-sm-6">
                            <div class="card">
                                <div class="nk-ecwg nk-ecwg6">
                                    <div class="card-inner">
                                        <div class="card-title-group">
                                            <div class="card-title">
                                                <h6 class="title">Low Stock Alerts</h6>
                                            </div>
                                        </div>
                                        <div class="data">
                                            <div class="amount text-warning">{{low_stock_items}}</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-xxl-3 col-sm-6">
                            <div class="card">
                                <div class="nk-ecwg nk-ecwg6">
                                    <div class="card-inner">
                                        <div class="card-title-group">
                                            <div class="card-title">
                                                <h6 class="title">Active POs</h6>
                                            </div>
                                        </div>
                                        <div class="data">
                                            <div class="amount">{{recent_pos}}</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-xxl-3 col-sm-6">
                            <div class="card">
                                <div class="nk-ecwg nk-ecwg6">
                                    <div class="card-inner">
                                        <div class="card-title-group">
                                            <div class="card-title">
                                                <h6 class="title">System Users</h6>
                                            </div>
                                        </div>
                                        <div class="data">
                                            <div class="amount">{{count}}</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Stock Alerts Section -->
                {% if pending_transfers or in_transit_transfers or awaiting_collection_transfers or active_commitments %}
                <div class="nk-block">
                    <div class="nk-block-head nk-block-head-sm">
                        <div class="nk-block-between">
                            <div class="nk-block-head-content">
                                <h5 class="nk-block-title">Stock Alerts & Activities</h5>
                                <p class="nk-block-des">Items requiring attention across all operations</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row g-gs">
                        <!-- Include the same alert sections as original home.html -->
                        {% if pending_transfers %}
                        <div class="col-lg-6">
                            <div class="card">
                                <div class="card-inner">
                                    <div class="card-title-group">
                                        <div class="card-title">
                                            <h6 class="title text-warning">
                                                <em class="icon ni ni-clock"></em>
                                                Pending Transfers ({{ pending_transfers.count }})
                                            </h6>
                                        </div>
                                    </div>
                                    <div class="card-text">
                                        {% for transfer in pending_transfers|slice:":5" %}
                                        <div class="alert alert-warning alert-pro alert-dismissible" role="alert">
                                            <div class="alert-text">
                                                <strong>{{ transfer.stock.item_name }}</strong><br>
                                                <small>{{ transfer.quantity }} units from {{ transfer.from_location.name }} → {{ transfer.to_location.name }}</small><br>
                                                <small class="text-muted">{{ transfer.get_transfer_type_display }} • Created {{ transfer.created_at|timesince }} ago</small>
                                            </div>
                                            <div class="alert-action">
                                                <a href="{% url 'transfer_list' %}" class="btn btn-xs btn-outline-warning">View</a>
                                            </div>
                                        </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endif %}

                        {% if active_commitments %}
                        <div class="col-lg-6">
                            <div class="card">
                                <div class="card-inner">
                                    <div class="card-title-group">
                                        <div class="card-title">
                                            <h6 class="title text-primary">
                                                <em class="icon ni ni-user-fill"></em>
                                                Customer Commitments ({{ active_commitments.count }})
                                            </h6>
                                        </div>
                                    </div>
                                    <div class="card-text" style="max-height: 400px; overflow-y: auto;">
                                        {% for commitment in active_commitments|slice:":5" %}
                                        <div class="alert alert-primary alert-pro alert-dismissible" role="alert">
                                            <div class="alert-text">
                                                <strong>{{ commitment.stock.item_name }}</strong><br>
                                                <small><strong>Customer:</strong> {{ commitment.customer_name }}</small><br>
                                                <small><strong>Quantity:</strong> {{ commitment.quantity }} units</small><br>
                                                <small><strong>Deposit:</strong> ${{ commitment.deposit_amount }}</small><br>
                                                <small class="text-muted">Committed {{ commitment.committed_at|timesince }} ago</small>
                                            </div>
                                            <div class="alert-action">
                                                <a href="{% url 'stock_detail' commitment.stock.pk %}" class="btn btn-xs btn-outline-primary">View</a>
                                            </div>
                                        </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endif %}
                
                <!-- Charts Section (Keep original charts) -->
                <div class="nk-block">
                    <div class="row g-gs">
                         <div class="col-xxl-6">
                            <div class="card card-full">
                                <div class="nk-ecwg nk-ecwg8 h-100">
                                    <div class="card-inner">
                                        <div class="card-title-group mb-3">
                                            <div class="card-title">
                                                <h6 class="title">Stock Statistics by Item</h6>
                                            </div>
                                        </div>
                                        <div class="nk-ecwg8-ck">
                                          <canvas class="line-chart chartjs-render-monitor" id="solidLineChart" width="327" height="225" style="display: block; height: 180px; width: 262px;"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                         <div class="col-xxl-6">
                            <div class="card card-full">
                                <div class="nk-ecwg nk-ecwg8 h-100">
                                    <div class="card-inner">
                                        <div class="card-title-group mb-3">
                                            <div class="card-title">
                                                <h6 class="title">Stock Statistics by Category</h6>
                                            </div>
                                        </div>
                                        <div class="nk-ecwg8-ck">
                                          <canvas class="pie-chart chartjs-render-monitor" id="pieItemData" width="327" height="225" style="display: block; height: 180px; width: 262px;"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% include 'stock/footers.html' %}